---
rawResources:
  &boot bitwarden-bootstrap-issuer:
    apiVersion: cert-manager.io/v1
    kind: ClusterIssuer
    forceRename: *boot
    spec:
      spec:
        selfSigned: {}

  bitwarden-bootstrap-certificate:
    apiVersion: cert-manager.io/v1
    kind: Certificate
    spec:
      spec:
        # this is discouraged but required by ios
        # commonName: cert-manager-bitwarden-tls
        isCA: true
        secretName: bitwarden-tls-certs
        subject:
          organizations:
            - external-secrets.io
        dnsNames:
          - external-secrets-bitwarden-sdk-server.security.svc.cluster.local
          - bitwarden-sdk-server.security.svc.cluster.local
          - localhost
        ipAddresses:
          - 127.0.0.1
          - ::1
        privateKey:
          algorithm: RSA
          encoding: PKCS8
          size: 2048
        issuerRef:
          name: bitwarden-bootstrap-issuer
          kind: ClusterIssuer
          group: cert-manager.io

  bitwarden-certificate-issuer:
    apiVersion: cert-manager.io/v1
    kind: ClusterIssuer
    spec:
      spec:
        ca:
          secretName: bitwarden-tls-certs

  bitwarden-tls-certs:
    apiVersion: cert-manager.io/v1
    kind: Certificate
    spec:
      spec:
        secretName: bitwarden-tls-certs
        dnsNames:
          - bitwarden-sdk-server.security.svc.cluster.local
          - external-secrets-bitwarden-sdk-server.security.svc.cluster.local
          - localhost
        ipAddresses:
          - 127.0.0.1
          - ::1
        privateKey:
          algorithm: RSA
          encoding: PKCS8
          size: 2048
        issuerRef:
          name: bitwarden-certificate-issuer
          kind: ClusterIssuer
          group: cert-manager.io
