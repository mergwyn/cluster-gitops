---
resources:
  - apiVersion: external-secrets.io/v1
    kind: ExternalSecret
    metadata:
      name: &creds privatevpn-ovn
      labels:
        app.kubernetes.io/name: pod-gateway
    spec:
      refreshPolicy: OnChange
      secretStoreRef:
        kind: ClusterSecretStore
        name: bitwarden
      target:
        name: *creds
        creationPolicy: Owner
      dataFrom:
        - extract:
            key: privatevpn_ovn

  - apiVersion: external-secrets.io/v1
    kind: ExternalSecret
    metadata:
      name: &auth gluetun-auth
      labels:
        app.kubernetes.io/name: pod-gateway
    spec:
      refreshPolicy: OnChange
      secretStoreRef:
        kind: ClusterSecretStore
        name: bitwarden
      target:
        name: *auth
        creationPolicy: Owner
        template:
          data:
            config.toml: |
              [[roles]]
              name = "exporter"
              auth = "apikey"
              apikey = "{{ .apikey }}"
      dataFrom:
        - extract:
            key: gluetun_auth
