---
# yaml-language-server: $schema=https://json.schemastore.org/helmfile

helmDefaults:
  cleanupOnFail: true
  wait: true
  waitForJobs: true

repositories:
  - name: prometheus-community
    url: https://prometheus-community.github.io/helm-charts/

releases:
  - name: kube-prometheus-stack
    chart: prometheus-community/kube-prometheus-stack
    namespace: monitoring
    version: 81.5.0
    set:
      # Bootstrap-only: install CRDs so ArgoCD can manage prometheysRule resources.
      # Runtime is installed later by ArgoCD using the same chart.
      - name: crds.enabled
        value: true
      - name: prometheusOperator.enabled
        value: false
      - name: prometheus.enabled
        value: false
      - name: alertmanager.enabled
        value: false
      - name: grafana.enabled
        value: false
      - name: kubeStateMetrics.enabled
        value: false
      - name: nodeExporter.enabled
        value: false
      - name: coreDns.enabled
        value: false
      - name: kubeControllerManager.enabled
        value: false
      - name: kubeEtcd.enabled
        value: false
      - name: kubeProxy.enabled
        value: false
      - name: kubeScheduler.enabled
        value: false

  - name: traefik
    namespace: network
    chart: oci://ghcr.io/traefik/helm/traefik
    version: 38.0.2
    set:
      # Bootstrap-only: install CRDs so ArgoCD can manage IngressRoute resources.
      # Runtime is installed later by ArgoCD using the same chart.
      - name: providers.kubernetesCRD.enabled
        value: true
      - name: providers.kubernetesIngress.enabled
        value: false
      - name: service.enabled
        value: false
