---
image:
  repository: ghcr.io/external-secrets/external-secrets
  # tag: v0.19.2

installCRDs: true

replicaCount: 2

serviceMonitor:
  enabled: true
  interval: 1m

certController:
  image:
    repository: ghcr.io/external-secrets/external-secrets
  serviceMonitor:
    enabled: true
    interval: 1m
webhook:
  image:
    repository: ghcr.io/external-secrets/external-secrets
  serviceMonitor:
    enabled: true
    interval: 1m

grafanaDashboard:
  enabled: true

bitwarden-sdk-server:
  enabled: true
  podAnnotations:
    secret.reloader.stakater.com/reload: |
      'bitwarden-access-token,bitwarden-tls-certs,bitwarden-css-certs'


# CSS for bitwarden and associated certificates
extraObjects:
#  - |
#    apiVersion: external-secrets.io/v1
#    kind: ClusterSecretStore
#    metadata:
#      name: bitwarden
#    spec:
#      provider:
#        bitwardensecretsmanager:
#          apiURL: https://api.bitwarden.com
#          identityURL: https://identity.bitwarden.com
#          auth:
#            secretRef:
#              credentials:
#                key: token
#                name: bitwarden-access-token
#                namespace: security
#          bitwardenServerSDKURL: https://bitwarden-sdk-server.security.svc.cluster.local:9998
#          organizationID: 3c3e91e1-ea8a-4112-870d-b13101194ab4
#          projectID: b2575a9a-5a8b-4c80-b2db-b1310119ab00
#          caProvider:
#            namespace: security
#            type: Secret
#            name: bitwarden-css-certs
#            key: ca.crt
  - |
    apiVersion: cert-manager.io/v1
    kind: Certificate
    metadata:
      name: &tls bitwarden-tls-certs
    spec:
      secretName: *tls
      isCA: true
      dnsNames:
        - bitwarden-sdk-server.security.svc.cluster.local
        - localhost
      ipAddresses:
        - 127.0.0.1
        - ::1
      privateKey:
        algorithm: RSA
        encoding: PKCS8
        size: 2048
        rotationPolicy: Always
      duration: 168h # 7d
      renewBefore: 24h # 1d
      issuerRef:
        name: cluster-signed-issuer
        kind: ClusterIssuer
        group: cert-manager.io
  - |
    apiVersion: cert-manager.io/v1
    kind: Certificate
    metadata:
      name: &css bitwarden-css-certs
    spec:
      secretName: *css
      isCA: true
      dnsNames:
        - bitwarden-sdk-server.security.svc.cluster.local
        - localhost
      ipAddresses:
        - 127.0.0.1
        - ::1
      privateKey:
        algorithm: RSA
        encoding: PKCS8
        size: 2048
        rotationPolicy: Always
      duration: 168h # 7d
      renewBefore: 24h # 1d
      issuerRef:
        name: cluster-signed-issuer
        kind: ClusterIssuer
        group: cert-manager.io
