---
helmDefaults:
  cleanupOnFail: true
  wait: true
  waitForJobs: true

repositories:
  - name: bedag
    url: https://bedag.github.io/helm-charts/
  - name: jetstack
    url: https://charts.jetstack.io/
  - name: external-secrets
    url: https://charts.external-secrets.io/
  - name: argoproj
    url: https://argoproj.github.io/argo-helm/

releases:
  - name: cert-manager-cloudflare-token
    chart: bedag/raw
    version: 2.0.2
    secrets:
      - ../../base/security/cert-manager/cloudflare-cert-manager-token-sops.yaml

  - name: cert-manager
    namespace: security
    chart: jetstack/cert-manager
    version: v1.19.2
    values:
      - ../../base/security/cert-manager/values.yaml

  - name: cert-manager-resources
    namespace: security
    chart: bedag/raw
    version: 2.0.2
    values:
      - ../../base/security/cert-manager/resources.yaml
    needs:
      - security/cert-manager

  - name: external-secrets
    namespace: security
    chart: external-secrets/external-secrets
    version: 1.2.1
    values:
      - ../../base/security/external-secrets/values.yaml
    needs:
      - security/cert-manager-resources

  - name: bitwarden-access-token
    namespace: security
    chart: bedag/raw
    version: 2.0.2
    secrets:
      - ../../base/security/external-secrets/bitwarden-access-token-sops.yaml

  - name: bitwarden-store
    namespace: security
    chart: bedag/raw
    version: 2.0.2
    values:
      - ../../base/security/external-secrets/bitwarden-store.yaml
    needs:
      - security/external-secrets
      - security/bitwarden-access-token

  - name: argocd-externalsecret
    namespace: argocd
    chart: bedag/raw
    version: 2.0.2
    values:
      - ../../base/argocd/argocd/externalsecret.yaml
    needs:
      - security/bitwarden-store

  - name: argocd
    namespace: argocd
    chart: argoproj/argo-cd
    version: 9.2.3
    values:
      - ../../base/argocd/argocd/values.yaml
    needs:
      - argocd/argocd-externalsecret
