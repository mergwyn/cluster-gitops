---
bases:
  - ../../../clusters/environments.yaml

---
repositories:
  - name: metallb
    url: https://metallb.github.io/metallb
  - name: bedag
    url: https://bedag.github.io/helm-charts/

releases:
  - name: metallb
    chart: metallb/metallb
    namespace: '{{ env "HELMFILE_NAMESPACE" }}'
    wait: true
    timeout: 300
    values:
      - loadBalancerClass: "metallb.io/internal"

  # Use a raw chart to deploy the Config CRDs after the operator is ready
  - name: metallb-config
    chart: bedag/raw
    namespace: '{{ env "HELMFILE_NAMESPACE" }}'
    needs:
      - metallb-system/metallb
    values:
      - values.yaml.gotmpl
